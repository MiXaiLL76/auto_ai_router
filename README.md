# ü§ñ Auto AI Router

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º LLM API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π proxy-—Ü–µ–ø–æ—á–µ–∫.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- **OpenAI** (–≤–∫–ª—é—á–∞—è Azure OpenAI)
- **Google Vertex AI**
- **Anthropic Claude**
- **Proxy** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ü–µ–ø–æ—á–µ–∫ —Ä–æ—É—Ç–µ—Ä–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏)

### –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

- **Round-robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ credentials
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ª–∏–º–∏—Ç–æ–≤**:
  - Credential level: RPM –∏ TPM –ª–∏–º–∏—Ç—ã
  - Model level: —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –ø–∞—Ä—ã (credential + model)
- **Model-aware routing**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏
- **Fail2ban –º–µ—Ö–∞–Ω–∏–∑–º**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –¥–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏, —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- **HTTP /health endpoint**: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ credentials –∏ models –≤ JSON –∏ HTML —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ proxy**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏–∑ remote proxy –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

### –î—Ä—É–≥–æ–µ

- **Master key –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –µ–¥–∏–Ω—ã–π –∫–ª—é—á –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- **Streaming –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: Server-Sent Events (SSE)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–ª–µ–π (embeddings, base64)

______________________________________________________________________

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21+ –∏–ª–∏ Docker

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞

```bash
# Clone –∏ build
git clone https://github.com/mixaill76/auto_ai_router.git
cd auto_ai_router
go build -o auto_ai_router ./cmd/server/

# –ó–∞–ø—É—Å–∫
./auto_ai_router -config config.yaml
```

### Docker

```bash
docker build -t auto-ai-router:latest .
docker run -p 8080:8080 -v $(pwd)/config.yaml:/app/config.yaml auto-ai-router:latest
```

______________________________________________________________________

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä (config.yaml)

```yaml
server:
  port: 8080
  max_body_size_mb: 100  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
  request_timeout: 60s  # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
  logging_level: info  # info, debug, error
  master_key: "sk-your-master-key-here"  # –¢—Ä–µ–±—É–µ—Ç—Å—è: –∫–ª—é—á –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  default_models_rpm: -1  # -1 = –±–µ–∑ –ª–∏–º–∏—Ç–∞ (default)

fail2ban:
  max_attempts: 3
  ban_duration: permanent
  error_codes: [401, 403, 429, 500, 502, 503, 504]

monitoring:
  prometheus_enabled: true

credentials:
  # OpenAI credential
  - name: "openai_main"
    type: "openai"
    api_key: "sk-proj-xxxxxxxxxxxxx"
    base_url: "https://api.openai.com"
    rpm: 100
    tpm: 50000

  # Vertex AI credential
  - name: "vertex_ai"
    type: "vertex-ai"
    project_id: "your-gcp-project"
    location: "global"
    credentials_file: "path/to/service-account.json"
    rpm: 100
    tpm: 50000

  # Proxy credential - fallback –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
  - name: "proxy_fallback"
    type: "proxy"
    base_url: "http://backup-router.local:8080"  # URL –¥—Ä—É–≥–æ–≥–æ auto_ai_router
    api_key: "sk-remote-key"  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    is_fallback: true  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ fallback

# –ú–æ–¥–µ–ª–∏ —Å –ª–∏–º–∏—Ç–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
models:
  - name: "gpt-4o"
    credential: openai_main
    rpm: 100
    tpm: 50000
  - name: "gemini-2.5-pro"
    credential: vertex_ai
    rpm: 100
    tpm: 50000
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞ (server)

| –ü–∞—Ä–∞–º–µ—Ç—Ä                   | –¢–∏–ø      | –î–µ—Ñ–æ–ª—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                          |
| -------------------------- | -------- | ------ | ------------------------------------------------- |
| `port`                     | int      | 8080   | –ü–æ—Ä—Ç –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è                            |
| `max_body_size_mb`         | int      | 100    | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (–ú–ë)             |
| `response_body_multiplier` | int      | 10     | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ—Ç–≤–µ—Ç–∞               |
| `request_timeout`          | duration | 60s    | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞                                   |
| `write_timeout`            | duration | 60s    | HTTP —Ç–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ –æ—Ç–≤–µ—Ç–∞                        |
| `idle_timeout`             | duration | 2m     | HTTP —Ç–∞–π–º–∞—É—Ç –ø—Ä–æ—Å—Ç–æ—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è                   |
| `idle_conn_timeout`        | duration | 120s   | –¢–∞–π–º–∞—É—Ç –ø—Ä–æ—Å—Ç–æ—è –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π   |
| `max_idle_conns`           | int      | 200    | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π           |
| `max_idle_conns_per_host`  | int      | 20     | –ú–∞–∫—Å–∏–º—É–º idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ –æ–¥–∏–Ω —Ö–æ—Å—Ç             |
| `logging_level`            | string   | info   | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (info, debug, error)          |
| `master_key`               | string   | -      | **–¢—Ä–µ–±—É–µ—Ç—Å—è**: –ú–∞—Å—Ç–µ—Ä-–∫–ª—é—á –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏            |
| `default_models_rpm`       | int      | -1     | RPM –ª–∏–º–∏—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (-1 = –±–µ–∑ –ª–∏–º–∏—Ç–∞)          |
| `model_prices_link`        | string   | -      | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: URL –∏–ª–∏ –ø—É—Ç—å –∫ JSON —Å —Ü–µ–Ω–∞–º–∏ –º–æ–¥–µ–ª–µ–π |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Fail2Ban (fail2ban)

| –ü–∞—Ä–∞–º–µ—Ç—Ä           | –û–ø–∏—Å–∞–Ω–∏–µ                                         |
| ------------------ | ------------------------------------------------ |
| `max_attempts`     | –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –±–∞–Ω–∞                         |
| `ban_duration`     | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–Ω–∞ ("permanent" –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ)  |
| `error_codes`      | –°–ø–∏—Å–æ–∫ HTTP –∫–æ–¥–æ–≤ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –±–∞–Ω–∞          |
| `error_code_rules` | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫ |

–ü—Ä–∏–º–µ—Ä —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:

```yaml
fail2ban:
  max_attempts: 3
  ban_duration: permanent
  error_codes: [401, 403, 429, 500, 502, 503, 504]
  error_code_rules:
    - code: 429  # Rate limit –æ—à–∏–±–∫–∏
      max_attempts: 5
      ban_duration: 5m
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (monitoring)

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| -------------------- | ------ | ----------------------------------------- |
| `prometheus_enabled` | bool   | –í–∫–ª—é—á–∏—Ç—å Prometheus –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `/metrics` |
| `log_errors`         | bool   | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª                  |
| `errors_log_path`    | string | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫           |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: `/health` endpoint —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ `"/health"` –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã LiteLLM DB (litellm_db)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LiteLLM –±–∞–∑–æ–π –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä                | –¢–∏–ø      | –î–µ—Ñ–æ–ª—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                                   |
| ----------------------- | -------- | ------ | ---------------------------------------------------------- |
| `enabled`               | bool     | false  | –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é                                        |
| `is_required`           | bool     | false  | –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –ª–∏ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ                                |
| `database_url`          | string   | -      | PostgreSQL connection string (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) |
| `max_conns`             | int      | 25     | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π                         |
| `min_conns`             | int      | 5      | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π                          |
| `health_check_interval` | duration | 10s    | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –ë–î                              |
| `connect_timeout`       | duration | 5s     | –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è                                        |
| `auth_cache_ttl`        | duration | 20s    | TTL –∫—ç—à–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏                                       |
| `auth_cache_size`       | int      | 10000  | –†–∞–∑–º–µ—Ä –∫—ç—à–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏                                    |
| `log_queue_size`        | int      | 5000   | –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤                        |
| `log_batch_size`        | int      | 100    | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –ª–æ–≥–æ–≤                             |
| `log_flush_interval`    | duration | 5s     | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±—Ä–æ—Å–∞ –ª–æ–≥–æ–≤ –≤ –ë–î                                 |
| `log_retry_attempts`    | int      | 3      | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ                      |
| `log_retry_delay`       | duration | 1s     | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏                                   |

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```yaml
litellm_db:
  enabled: true
  is_required: false
  database_url: "postgresql://user:password@localhost:5432/litellm"
  max_conns: 25
  min_conns: 5
  log_queue_size: 5000
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä    | Type        | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è                                                   |
| ------------ | ----------- | ------------------------------------------------------------------- |
| OpenAI       | `openai`    | `api_key`, `base_url`                                               |
| Anthropic    | `anthropic` | `api_key`, `base_url`                                               |
| Vertex AI    | `vertex-ai` | `project_id`, `location`, `credentials_file` –∏–ª–∏ `credentials_json` |
| Proxy Router | `proxy`     | `base_url`                                                          |

### Proxy –∫–∞–∫ fallback

Proxy credentials –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ø–æ—á–∫—É —Ä–æ—É—Ç–µ—Ä–æ–≤:

```yaml
credentials:
  # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
  - name: "openai_main"
    type: "openai"
    api_key: "sk-..."
    base_url: "https://api.openai.com"
    rpm: 100
    tpm: 50000

  # Fallback: –¥—Ä—É–≥–æ–π –∏–Ω—Å—Ç–∞–Ω—Å auto_ai_router
  - name: "backup_router"
    type: "proxy"
    base_url: "http://10.0.1.50:8080"
    is_fallback: true  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ credentials –∏—Å—á–µ—Ä–ø–∞–Ω—ã
```

–ö–æ–≥–¥–∞ `openai_main` –∏—Å—á–µ—Ä–ø–∞–µ—Ç —Å–≤–æ–∏ –ª–∏–º–∏—Ç—ã, –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ `backup_router`.

______________________________________________________________________

## üîå API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—Ä–æ—Å –∫ —Ä–æ—É—Ç–µ—Ä—É

```bash
curl -X POST http://localhost:8080/v1/chat/completions \
  -H "Authorization: Bearer sk-your-master-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```

### Health check

```bash
# JSON format
curl http://localhost:8080/health

# HTML dashboard
curl http://localhost:8080/vhealth
```

Health endpoint –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö credentials (RPM/TPM usage)
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö models
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö proxy –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

______________________________________________________________________

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

–î–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ `/metrics`:

- `auto_ai_router_credential_rpm_current` - —Ç–µ–∫—É—â–∏–π RPM usage
- `auto_ai_router_credential_tpm_current` - —Ç–µ–∫—É—â–∏–π TPM usage
- `auto_ai_router_credential_banned` - —Å—Ç–∞—Ç—É—Å –±–∞–Ω–∞
- `auto_ai_router_requests_total` - –≤—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `auto_ai_router_requests_duration_seconds` - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Proxy credentials **–Ω–µ** –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ Prometheus –º–µ—Ç—Ä–∏–∫–∏. –ò—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ `/health` endpoint –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–∑ remote `/health` endpoint –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

### HTML Dashboard

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080/vhealth –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∞—à–±–æ–∞—Ä–¥–∞.

______________________________________________________________________

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `os.environ/VARIABLE_NAME`:

```yaml
server:
  master_key: "os.environ/MASTER_KEY"
  model_prices_link: "os.environ/MODEL_PRICES_URL"

credentials:
  - name: "openai"
    type: "openai"
    api_key: "os.environ/OPENAI_API_KEY"
    base_url: "https://api.openai.com"

  - name: "vertex_ai"
    type: "vertex-ai"
    project_id: "os.environ/GCP_PROJECT_ID"
    location: "us-central1"
    credentials_json: "os.environ/VERTEX_CREDENTIALS"

litellm_db:
  enabled: true
  database_url: "os.environ/LITELLM_DATABASE_URL"
```

```bash
export MASTER_KEY="sk-your-master-key"
export OPENAI_API_KEY="sk-proj-..."
export GCP_PROJECT_ID="my-project"
export LITELLM_DATABASE_URL="postgresql://user:pass@localhost/litellm"
./auto_ai_router -config config.yaml
```

### Master Key

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç Authorization header —Å master key:

```bash
Authorization: Bearer sk-your-master-key-here
```

______________________________________________________________________

## üìö Advanced

### –ù–µ—Å–∫–æ–ª—å–∫–æ credentials –¥–ª—è –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏

```yaml
models:
  - name: "gpt-4o"
    credential: openai_main
    rpm: 100
  - name: "gpt-4o"
    credential: openai_secondary
    rpm: 100
```

–†–æ—É—Ç–µ—Ä –±—É–¥–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –æ–±–æ–∏–º–∏ credentials.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –≤—Å–µ—Ö credentials. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ü–∏—é `models` –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏.

______________________________________________________________________

## üîß Troubleshooting

### Rate limit behavior

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ª–∏–º–∏—Ç–æ–≤:

- **Credential level**: RPM (requests per minute) –∏ TPM (tokens per minute) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ API –∫–ª—é—á–∞
- **Model level**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ø–∞—Ä—ã (credential + model)

–ö–æ–≥–¥–∞ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø—ã–≤–∞–µ—Ç—Å—è:

1. –†–æ—É—Ç–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π credential —Å —Ç–æ–π –∂–µ –º–æ–¥–µ–ª—å—é (round-robin)
2. –ï—Å–ª–∏ –¥—Ä—É–≥–∏–µ credentials –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–ª–∏ —Ç–æ–∂–µ –∏—Å—á–µ—Ä–ø–∞–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `429 Too Many Requests`
3. –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã fallback proxies, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –Ω–∏—Ö

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤**:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
curl http://localhost:8080/health | jq '.credentials'
```

### Fallback behavior

Fallback proxies –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:

**–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç fallback**:

- –ü—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ RPM/TPM –ª–∏–º–∏—Ç–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ credential
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö `401`, `403`, `429`, `500`, `502`, `503`, `504` –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ü—Ä–∏ –¥—Ä—É–≥–∏—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (—Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏, —Ç–∞–π–º–∞—É—Ç—ã)

**–¶–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:

1. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π credential
2. –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª ‚Üí –ø—Ä–æ–±—É–µ—Ç—Å—è fallback proxy
3. Fallback proxy –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—Ä—É–≥–æ–π –Ω–∞–±–æ—Ä credentials –∏ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π
4. –ï—Å–ª–∏ fallback —Ç–æ–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∫–ª–∏–µ–Ω—Ç—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `503 Service Unavailable`

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ fallback**:

```yaml
credentials:
  - name: "openai_main"
    type: "openai"
    api_key: "sk-..."
    is_fallback: false  # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

  - name: "backup_router"
    type: "proxy"
    base_url: "http://backup:8080"
    is_fallback: true   # Fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä
```

### Common issues

**"Service Unavailable" (503)**:

- –í—Å–µ credentials –∏—Å—á–µ—Ä–ø–∞–ª–∏ –ª–∏–º–∏—Ç—ã
- –í—Å–µ fallback proxies –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- –†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á–∏—Ç—å RPM/TPM –ª–∏–º–∏—Ç—ã –∏–ª–∏ –¥–æ–∂–¥–∞—Ç—å—Å—è —Å–±—Ä–æ—Å–∞ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

**"Too Many Requests" (429)**:

- –¢–µ–∫—É—â–∏–π credential –∏—Å—á–µ—Ä–ø–∞–ª TPM –ª–∏–º–∏—Ç
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö credentials
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ credentials –¥–ª—è —Ç–æ–π –∂–µ –º–æ–¥–µ–ª–∏ –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å TPM

**"Unauthorized" (401/403)**:

- –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
- –ö–ª—é—á –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –æ–±–Ω–æ–≤–∏—Ç—å API –∫–ª—é—á

______________________________________________________________________

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
go test ./...
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Debug mode
./auto_ai_router -config config.yaml  # logging_level: debug
```

______________________________________________________________________

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. LICENSE —Ñ–∞–π–ª.

______________________________________________________________________

## ü§ù –ö–æ–Ω—Ç—Ä–∏–±—å—é—à–µ–Ω—ã

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è issue –∏ pull requests!
